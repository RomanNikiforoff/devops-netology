# Домашнее задание к занятию "Управляющие конструкции в коде Terraform"

### Цель задания

1. Создать свои первые ресурсы в облаке Yandex cloud с помощью terraform.
2. Освоить работу с переменными terraform

------

### Чеклист готовности к домашнему заданию

1. Зарегистрирован аккаунт в Yandex Cloud. Использован промокод на грант.
2. установлен инструмент yandex cli
3. Исходный код для выполнения задания расположен в директории **03/src**.
4. Любые ВМ, использованные при выполнении задания должны быть прерываемыми, для экономии средств.

------

### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

1. https://console.cloud.yandex.ru/folders/<cloud_id>/vpc/security-groups
2. https://cloud.yandex.ru/docs/vpc/concepts/security-groups?from=int-console-help-center-or-nav
3. https://terraform-eap.website.yandexcloud.net/docs/providers/yandex/d/datasource_compute_disk.html


### Задание 1

1. Изучите проект. Заполните файл personal.auto.tfvars
2. Инициализируйте проект, выполните код.

Примечание: Если у вас не активирован preview доступ к функционалу "Группы безопасности" в Yandex Cloud - запросите доступ у поддержки облачного провайдера. Обычно его выдают в течении 24-х часов. 

Приложите скриншот входящих правил "Группы безопасности" в ЛК yandex cloud  или скриншот отказа в предоставлении доступа к preview версии.

![image](https://github.com/RomanNikiforoff/devops-netology/blob/main/pic/ter-03-sec-gr.png)

------

### Задание 2
1. Создайте файл count-vm.tf. Опишите в нем создание двух **одинаковых** виртуальных машин, используя мета-аргумент **count loop**.
2. Создайте файл for_each-vm.tf. Опишите в нем создание 2 **разных** по cpu/ram/disk виртуальных машин, используя мета-аргумент **for_each loop**. Используйте переменную типа list(object({ vm_name=string, cpu=number, ram=number, disk=number  })). При желании внесите в переменную все возможные параметры.
3. ВМ из пункта 2.2 должны создаваться после создания ВМ из пункта 2.1
4. Используйте функцию file в local переменной для считывания ключа ~/.ssh/id_rsa.pub и его последующего использования в блоке metadata.
5. Инициализируйте проект, выполните код.
------
### Задание 3
1. Создайте 3 одинаковых виртуальных диска, размером 1 Гб с помощью ресурса yandex_compute_disk и мета-аргумента count.
2. Создайте одну **любую** ВМ. Используйте блок **dynamic secondary_disk{..}** и мета-аргумент for_each для подключения созданных вами дополнительных дисков.
3. Подключите к ВМ созданную в 1-м задании группу безопасности.

------
### Задание 4
1. Создайте inventory-файл для ansible.
Используте функцию tepmplatefile и файл-шаблон для создания ansible inventory-файла из лекции.
Передайте в него в качестве переменных имена и внешние ip-адреса ВМ из задания 2.1 и 2.2.
2. Выполните код. Приложите скриншот получившегося файла.

![image](https://github.com/RomanNikiforoff/devops-netology/blob/main/pic/ter-03-task-4.png)

Для общего зачета создайте в вашем github репозитории новую ветку terraform-03. Закомитьте в эту ветку свой финальный код проекта, пришлите ссылку на коммит. **Удалите все созданные ресурсы**.

------

### Задание 5*(необязательное)
1. Напишите output, который отобразит все 5 созданных ВМ в виде списка словарей:
``` 
[
 {
  "name" = 'имя ВМ1'
  "id"   = 'идентификатор ВМ1'
  "fqdn" = 'Внутренний FQDN ВМ1'
 },
 {
  "name" = 'имя ВМ2'
  "id"   = 'идентификатор ВМ2'
  "fqdn" = 'Внутренний FQDN ВМ2'
 },
 ....
]
```
Приложите скриншот вывода команды ```terrafrom output```

------

### Задание 6*(необязательное)

1. Напишите или возьмите в интернете готовый ansible-playbook для установки nginx web server.
2. Используя null_resource и local-exec примените данный ansible-playbook к ВМ из ansible inventory файла.

Для зачета предоставьте код вместе с основной частью задания.
### Правила приема работы

1. Отправлена ссылка на репозиторий (github) с выполненным заданием.

------
